{% extends 'base_applications.html' %}


{% block title %}
Appications reporting
{% endblock title %}

{% block tabs %}
<div>
  <table class="table">
    <thead class="thead-light">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Название проекта</th>
        <th scope="col">Дата оформления</th>
        <th scope="col">Документ</th>
        <th scope='col'>Одобрено/Не одобрено</th>
        <th scope="col">Статус отчета</th>
        <th scope="col">Замечания</th>
        {% if not request.user.is_staff or not request.user.is_expert %}
          <th scope="col">Редактировать</th>
        {% endif %}
        {% if not request.user.is_staff or not request.user.is_expert %}
          <th scope="col">Удалить отчет</th>
        {% endif %}
        <th scope="col">Период</th>
      </tr>
    </thead>
    <tbody>
    {% for item in application  %}
      <tr>
        <th scope="row">{{ item.id }}</th>
        <td>{{ item.app.project_name }} <span class="badge badge-info">{{ item.notifications }}</span></td>
        <td>{{ item.app.data_create }}</td>
        <td><a href="http://{{ request.get_host }}/media/{{ item.upload }}">Файл</a></td>
        <td>
          {% if request.user.is_staff or request.user.is_expert %}
            {% if not item.status %}
                <a class="btn btn-info" href="{% url 'switch_status_rep' item.pk %}">Одобрить</a>
                <p>Не одобрено</p>
            {% else %}
                <a class="btn btn-info" href="{% url 'switch_status_rep' item.pk %}">Отказать</a>
                <p>Одобрено</p>
            {% endif %}
          {% else %}
              {% if item.status %}
                Одобрено
              {% else %}
                Не одобрено
              {% endif %}
          {% endif %}
        </td>

        {% if False in statuses %}
          <td>
            {% if item.status %}
              <p>Отправлено</p>
            {% else %}
              {% if request.user == item.user %}
                  <a class="btn btn-info" href="{% url 'send_report' item.pk %}">Отправить на проверку</a>
              {% else %}
                  <p>Не отправлено</p>
              {% endif %}
            {% endif %}
          </td>
        {% endif %}

        <td>

        <td><a class="btn btn-info" href="{% url 'reports_detail_url' item.pk %}">Перейти</a></td>

        {% if not request.user.is_staff or not request.user.is_expert %}
          <td><a class="btn btn-info" href="{% url 'report_update_url' item.pk %}">Изменить</a></td>
        {% endif %}

        {% if not request.user.is_staff or not request.user.is_expert %}
          <td><a class="btn btn-danger" href="{% url 'report_delete_url' item.pk %}">Удалить</a></td>
        {% endif %}

        <td>{{item.year}} год , {{item.quarter}}-й квартал</td>

      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock tabs %}